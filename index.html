<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moxon (github.com/MaksimKlyu/moxon-cli)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; display: flex; justify-content: center; align-items: center; }
        .container { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 30px; max-width: 1000px; width: 100%; }
        h1 { color: #333; font-size: 18px; margin-bottom: 5px; }
        .subtitle { color: #666; font-size: 13px; margin-bottom: 20px; }
        .subtitle a { color: #667eea; text-decoration: none; font-weight: bold; }
        .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: #444; font-size: 13px; }
        input, select { width: 100%; padding: 10px; border: 2px solid #eee; border-radius: 8px; font-size: 15px; outline: none; }
        button { 
            width: 100%; padding: 14px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer; transition: 0.2s; 
        }
        button:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .results { margin-top: 25px; display: none; }
        .results.show { display: block; }
        .results-header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 15px; 
        }
        .diagram-container { background: #fff; border: 1px solid #eee; border-radius: 10px; margin: 15px 0; padding: 10px; overflow: hidden; }
        #antennaDiagram { width: 100%; height: auto; display: block; }
        .antenna-element { fill: none; stroke: #4a90e2; stroke-linecap: round; stroke-linejoin: round; }
        .antenna-internal { fill: none; stroke: #ccc; stroke-width: 1; stroke-dasharray: 5,5; }
        .dimension-line { stroke: #333; stroke-width: 1.2; }
        .dimension-text { font-family: 'Courier New', monospace; font-size: 14px; font-weight: bold; fill: #000; text-anchor: middle; }
        .extension-line { stroke: #bbb; stroke-width: 0.8; }
        .legend-text { font-family: monospace; font-size: 11px; fill: #888; }
        .dim-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .card { background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 4px solid #667eea; }
        .card label { font-size: 11px; text-transform: uppercase; color: #888; margin-bottom: 4px; display: block; }
        .card div { font-size: 18px; font-weight: 800; color: #333; }
        @media (max-width: 600px) { .form-grid, .dim-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<div class="container">
    <h1>Moxon 868 MHz | <a href="https://makerworld.com/ru/models/1925186" target="_blank">WhyNotLayers</a></h1>
    <h1>Moxon W4RNL | <a href="https://antenna2.github.io/cebik/content/moxon/moxpage.html" target="_blank">L. B. Cebik</a></h1>
    <p class="subtitle">Antenna Calculator & Drawing Tool</p>
    <form id="moxonForm">
        <div class="form-grid">
            <div><label>Method</label><select id="method"><option value="layers">Moxon 1.1 (WhyNotLayers)</option><option value="cebik">Moxon | L. B. Cebik, W4RNL</option></select></div>
            <div><label>Freq (MHz)</label><input type="number" id="freq" value="868" step="0.01"></div>
            <div><label>Wire Diam (mm)</label><input type="number" id="diam" value="1.5" step="0.001"></div>
        </div>
        <button type="submit">Calculate & Update Diagram</button>
    </form>
    <div class="results" id="results">
        <div class="results-header" id="resHeader"></div>
        <div class="diagram-container"><svg id="antennaDiagram"></svg></div>
        <div class="dim-grid">
            <div class="card"><label>A: Width</label><div id="outA"></div></div>
            <div class="card"><label>B: Driver</label><div id="outB"></div></div>
            <div class="card"><label>C: Gap</label><div id="outC"></div></div>
            <div class="card"><label>D: Reflector</label><div id="outD"></div></div>
            <div class="card"><label>E: Height</label><div id="outE"></div></div>
            <div class="card" style="border-left-color:#e74c3c"><label>Impedance</label><div id="outZ"></div></div>
        </div>
    </div>
</div>
<script>
    const svgNS = "http://www.w3.org/2000/svg";
    document.getElementById('moxonForm').onsubmit = function(e) {
        e.preventDefault();
        const f = parseFloat(document.getElementById('freq').value), d = parseFloat(document.getElementById('diam').value);
        const method = document.getElementById('method').value;
        let res = {};
        if (method === 'layers') {
            const lambda = 299792 / f;
            const fR = 868, dR = 1.5, lR = 299792 / fR;
            const k = (fr, di) => 1 - (0.025 / Math.log10((299792/fr)/di));
            const r = (lambda / lR) * (k(f, d) / k(fR, dR));
            res = { A: 124*r, B: 8.5*r, C: 18*r, D: 19.5*r, E: 46*r, z: 50 };
        } else {
            const diameter_inches = d / 25.3995;
            const conv = (983.5592 / f) * 304.794;
            const WD = Math.log10(f * diameter_inches / 11802.71);
            res.A = (-0.0008571 * WD * WD + -0.0095714 * WD + 0.33985714) * conv;
            res.B = (-0.0021429 * WD * WD + -0.0203571 * WD + 0.00828571) * conv;
            res.C = (0.00180952 * WD * WD + 0.01780952 * WD + 0.05164286) * conv;
            res.D = (0.001 * WD + 0.07178571) * conv;
            res.E = res.B + res.C + res.D; res.z = 50;
        }
        const totalW = (res.A*2) + (res.B*2) + (res.D*2);
        document.getElementById('outA').innerText = res.A.toFixed(2) + ' mm';
        document.getElementById('outB').innerText = res.B.toFixed(2) + ' mm';
        document.getElementById('outC').innerText = res.C.toFixed(2) + ' mm';
        document.getElementById('outD').innerText = res.D.toFixed(2) + ' mm';
        document.getElementById('outE').innerText = res.E.toFixed(2) + ' mm';
        document.getElementById('outZ').innerText = `~${res.z.toFixed(0)} Î©`;
        document.getElementById('resHeader').innerHTML = `<b>${method === 'layers' ? 'WhyNotLayers 1.1' : 'Cebik W4RNL'}</b><br>${f} MHz | Wire ${d} mm | Total: ${totalW.toFixed(1)} mm`;
        renderSVG(res.A, res.B, res.C, res.D, res.E, d);
        document.getElementById('results').classList.add('show');
    };
    function renderSVG(A, B, C, D, E, diam) {
        const svg = document.getElementById('antennaDiagram'); svg.innerHTML = '';
        const s = 8, w = A*s, h = E*s, b = B*s, c = C*s, d = D*s, pad = 120, sw = diam * 1.5;
        svg.setAttribute('viewBox', `-${pad} -${pad} ${w + pad*2} ${h + pad*2.3}`);
        const defs = document.createElementNS(svgNS, 'defs');
        const m = document.createElementNS(svgNS, 'marker');
        m.setAttribute('id', 'ar'); m.setAttribute('viewBox', '0 0 10 10'); m.setAttribute('refX', '10'); m.setAttribute('refY', '5');
        m.setAttribute('markerWidth', '6'); m.setAttribute('markerHeight', '6'); m.setAttribute('orient', 'auto-start-reverse');
        const p = document.createElementNS(svgNS, 'path'); p.setAttribute('d', 'M 0 0 L 10 5 L 0 10 z'); p.setAttribute('fill', '#333');
        m.appendChild(p); defs.appendChild(m); svg.appendChild(defs);
        const drawLine = (x1, y1, x2, y2, cls, wid) => {
            const l = document.createElementNS(svgNS, 'line');
            l.setAttribute('x1', x1); l.setAttribute('y1', y1); l.setAttribute('x2', x2); l.setAttribute('y2', y2);
            l.setAttribute('class', cls); if(wid) l.setAttribute('stroke-width', wid); svg.appendChild(l);
        };
        drawLine(0,0,w,0,'antenna-element',sw); drawLine(0,0,0,b,'antenna-element',sw); drawLine(w,0,w,b,'antenna-element',sw);
        drawLine(0,h,w,h,'antenna-element',sw); drawLine(0,h,0,h-d,'antenna-element',sw); drawLine(w,h,w,h-d,'antenna-element',sw);
        drawLine(w/2, 0, w/2, b, 'antenna-internal');
        drawLine(w/2, h-d, w/2, h, 'antenna-internal');
        const dim = (x1, y1, x2, y2, label, val, isV) => {
            const ex = (ex1, ey1, ex2, ey2) => {
                const el = document.createElementNS(svgNS, 'line');
                el.setAttribute('x1', ex1); el.setAttribute('y1', ey1); el.setAttribute('x2', ex2); el.setAttribute('y2', ey2);
                el.setAttribute('class', 'extension-line'); svg.appendChild(el);
            };
            if(!isV) { ex(x1,y1+5,x1,0); ex(x2,y1+5,x2,0); }
            else { const ax = x1 > w/2 ? w : 0; ex(ax,y1,x1+(x1>w/2?-5:5),y1); ex(ax,y2,x1+(x1>w/2?-5:5),y2); }
            const dl = document.createElementNS(svgNS, 'line');
            dl.setAttribute('x1', x1); dl.setAttribute('y1', y1); dl.setAttribute('x2', x2); dl.setAttribute('y2', y2);
            dl.setAttribute('class', 'dimension-line'); dl.setAttribute('marker-start', 'url(#ar)'); dl.setAttribute('marker-end', 'url(#ar)');
            svg.appendChild(dl);
            const txt = document.createElementNS(svgNS, 'text');
            txt.setAttribute('x', (x1+x2)/2); txt.setAttribute('y', (y1+y2)/2 - 10); 
            if(isV) {
                const centerX = (x1 + x2) / 2;
                const centerY = (y1 + y2) / 2;
                txt.setAttribute('transform', `rotate(-90, ${centerX}, ${centerY})`);
            }
            txt.setAttribute('class', 'dimension-text'); txt.setAttribute('text-anchor', 'middle');
            txt.textContent = `${label}: ${val.toFixed(2)}`; svg.appendChild(txt);
        };
        dim(0,-60,w,-60,'A',A,false); dim(-75,0,-75,b,'B',B,true); dim(-75,b,-75,b+c,'C',C,true);
        dim(-75,b+c,-75,h,'D',D,true); dim(w+75,0,w+75,h,'E',E,true);
        ["A: Width", "B: Driver", "C: Gap (Air)", "D: Reflector", "E: Full Height"].forEach((t, i) => {
            const lt = document.createElementNS(svgNS, 'text'); lt.setAttribute('x', -pad/2); lt.setAttribute('y', h + 80 + (i*18));
            lt.setAttribute('class', 'legend-text'); lt.textContent = t; svg.appendChild(lt);
        });
    }
</script>
</body>
</html>
